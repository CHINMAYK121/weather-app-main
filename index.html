<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon-32x32.png">
  <title>Frontend Mentor | Weather app</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,500;9..40,600;9..40,700&family=Bricolage+Grotesque:wght@700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="./assets/styles.css">

</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <img src="./assets/images/logo.svg" alt="Weather App Logo">
        <h1>Weather App</h1>
      </div>
      
      <div class="units-dropdown">
        <button class="units-button" id="unitsButton" aria-label="Units menu" aria-expanded="false">
          <img src="./assets/images/icon-units.svg" alt="">
          Units
        </button>
        <div class="units-menu" id="unitsMenu" role="menu">
          <h3>Switch to Imperial/Metric</h3>
          
          <div class="units-option" role="menuitemradio">
            <input type="radio" id="tempC" name="temperature" value="celsius" checked>
            <label for="tempC">Temperature: Celsius (°C)</label>
          </div>
          
          <div class="units-option" role="menuitemradio">
            <input type="radio" id="tempF" name="temperature" value="fahrenheit">
            <label for="tempF">Temperature: Fahrenheit (°F)</label>
          </div>
          
          <h3>Wind Speed</h3>
          
          <div class="units-option" role="menuitemradio">
            <input type="radio" id="windKmh" name="windSpeed" value="kmh" checked>
            <label for="windKmh">km/h</label>
          </div>
          
          <div class="units-option" role="menuitemradio">
            <input type="radio" id="windMph" name="windSpeed" value="mph">
            <label for="windMph">mph</label>
          </div>
          
          <h3>Precipitation</h3>
          
          <div class="units-option" role="menuitemradio">
            <input type="radio" id="precipMm" name="precipitation" value="mm" checked>
            <label for="precipMm">Millimeters (mm)</label>
          </div>
          
          <div class="units-option" role="menuitemradio">
            <input type="radio" id="precipIn" name="precipitation" value="in">
            <label for="precipIn">Inches (in)</label>
          </div>
        </div>
      </div>
    </header>

    <main>
      <section class="search-section">
        <h2 class="search-header">How's the sky looking today?</h2>
        <form class="search-form" id="searchForm">
          <div class="search-input-wrapper">
            <img src="./assets/images/icon-search.svg" alt="" class="search-icon">
            <input 
              type="text" 
              class="search-input" 
              id="searchInput"
              placeholder="Search for a city, e.g., New York"
              autocomplete="off"
            >
          </div>
          <button type="submit" class="search-button" id="searchButton">Search</button>
          <div class="search-error" id="searchError"></div>
        </form>
      </section>

      <div id="weatherContent">
        <div class="empty-state">
          <p>Search for a city to see weather information</p>
        </div>
      </div>
    </main>
  </div>

  <div class="attribution">
    Challenge by <a href="https://www.frontendmentor.io?ref=challenge" target="_blank">Frontend Mentor</a>. 
    Coded by <a href="#">Your Name Here</a>.
  </div>

  <script>
    // State management
    const state = {
      currentLocation: null,
      weatherData: null,
      selectedDayIndex: 0,
      units: {
        temperature: 'celsius',
        windSpeed: 'kmh',
        precipitation: 'mm'
      }
    };

    // Weather icon mapping
    const weatherIcons = {
      0: 'icon-sunny.webp',      // Clear sky
      1: 'icon-sunny.webp',      // Mainly clear
      2: 'icon-partly-cloudy.webp', // Partly cloudy
      3: 'icon-overcast.webp',   // Overcast
      45: 'icon-fog.webp',       // Fog
      48: 'icon-fog.webp',       // Depositing rime fog
      51: 'icon-drizzle.webp',   // Light drizzle
      53: 'icon-drizzle.webp',   // Moderate drizzle
      55: 'icon-drizzle.webp',   // Dense drizzle
      56: 'icon-drizzle.webp',   // Freezing drizzle
      57: 'icon-drizzle.webp',   // Dense freezing drizzle
      61: 'icon-rain.webp',      // Slight rain
      63: 'icon-rain.webp',      // Moderate rain
      65: 'icon-rain.webp',      // Heavy rain
      66: 'icon-rain.webp',      // Freezing rain
      67: 'icon-rain.webp',      // Heavy freezing rain
      71: 'icon-snow.webp',      // Slight snow
      73: 'icon-snow.webp',      // Moderate snow
      75: 'icon-snow.webp',      // Heavy snow
      77: 'icon-snow.webp',      // Snow grains
      80: 'icon-rain.webp',      // Slight rain showers
      81: 'icon-rain.webp',      // Moderate rain showers
      82: 'icon-storm.webp',     // Violent rain showers
      85: 'icon-snow.webp',      // Slight snow showers
      86: 'icon-snow.webp',      // Heavy snow showers
      95: 'icon-storm.webp',     // Thunderstorm
      96: 'icon-storm.webp',     // Thunderstorm with slight hail
      99: 'icon-storm.webp'      // Thunderstorm with heavy hail
    };

    // DOM elements
    const unitsButton = document.getElementById('unitsButton');
    const unitsMenu = document.getElementById('unitsMenu');
    const searchForm = document.getElementById('searchForm');
    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const searchError = document.getElementById('searchError');
    const weatherContent = document.getElementById('weatherContent');

    // Units dropdown toggle
    unitsButton.addEventListener('click', (e) => {
      e.stopPropagation();
      unitsMenu.classList.toggle('active');
      unitsButton.setAttribute('aria-expanded', unitsMenu.classList.contains('active'));
    });

    document.addEventListener('click', (e) => {
      if (!unitsMenu.contains(e.target) && !unitsButton.contains(e.target)) {
        unitsMenu.classList.remove('active');
        unitsButton.setAttribute('aria-expanded', 'false');
      }
    });

    // Units selection
    const unitRadios = unitsMenu.querySelectorAll('input[type="radio"]');
    unitRadios.forEach(radio => {
      radio.addEventListener('change', (e) => {
        const name = e.target.name;
        const value = e.target.value;
        state.units[name === 'temperature' ? 'temperature' : name === 'windSpeed' ? 'windSpeed' : 'precipitation'] = value;
        if (state.weatherData) {
          renderWeather();
        }
      });
    });

    // Search form submission
    searchForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const query = searchInput.value.trim();
      if (!query) return;
      
      await searchLocation(query);
    });

    // Geocoding API - search for location
    async function searchLocation(query) {
      try {
        setLoading(true);
        hideError();
        
        const response = await fetch(
          `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=1&language=en&format=json`
        );
        
        const data = await response.json();
        
        if (!data.results || data.results.length === 0) {
          showError('No results found. Please try a different city name.');
          setLoading(false);
          return;
        }

        const location = data.results[0];
        state.currentLocation = {
          name: location.name,
          country: location.country,
          latitude: location.latitude,
          longitude: location.longitude
        };

        await fetchWeather();
      } catch (error) {
        console.error('Search error:', error);
        showError('Failed to search for location. Please try again.');
        setLoading(false);
      }
    }

    // Fetch weather data
    async function fetchWeather() {
      try {
        setLoading(true);
        hideError();

        const { latitude, longitude } = state.currentLocation;
        const tempUnit = state.units.temperature === 'celsius' ? 'celsius' : 'fahrenheit';
        
        const response = await fetch(
          `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&temperature_unit=${tempUnit}`
        );

        if (!response.ok) {
          throw new Error('Failed to fetch weather data');
        }

        const data = await response.json();
        state.weatherData = data;
        state.selectedDayIndex = 0;
        
        setLoading(false);
        renderWeather();
      } catch (error) {
        console.error('Weather fetch error:', error);
        showError('Failed to load weather data. Please try again.');
        setLoading(false);
      }
    }

    // Render weather UI
    function renderWeather() {
      if (!state.weatherData || !state.currentLocation) return;

      const { current, daily, hourly } = state.weatherData;
      const { name, country } = state.currentLocation;

      const currentTemp = Math.round(current.temperature_2m);
      const feelsLike = Math.round(current.apparent_temperature);
      const humidity = current.relative_humidity_2m;
      const windSpeed = convertWindSpeed(current.wind_speed_10m);
      const precipitation = convertPrecipitation(current.precipitation);
      const weatherCode = current.weather_code;
      
      const weatherIcon = weatherIcons[weatherCode] || 'icon-sunny.webp';
      const weatherDescription = getWeatherDescription(weatherCode);

      // Today section
      const todayHTML = `
        <section class="today-section">
          <div class="today-content">
            <div class="location-name">${name}, ${country}</div>
            <div class="current-temp">${currentTemp}°</div>
            <div class="weather-icon-wrapper">
              <img src="./assets/images/${weatherIcon}" alt="${weatherDescription}" class="weather-icon">
              <div class="weather-description">${weatherDescription}</div>
            </div>
            <div class="weather-metrics">
              <div class="metric-item">
                <div class="metric-label">Feels like</div>
                <div class="metric-value">${feelsLike}°</div>
              </div>
              <div class="metric-item">
                <div class="metric-label">Humidity</div>
                <div class="metric-value">${humidity}%</div>
              </div>
              <div class="metric-item">
                <div class="metric-label">Wind</div>
                <div class="metric-value">${windSpeed}</div>
              </div>
              <div class="metric-item">
                <div class="metric-label">Precipitation</div>
                <div class="metric-value">${precipitation}</div>
              </div>
            </div>
          </div>
        </section>
      `;

      // Daily forecast
      const dailyHTML = `
        <section class="daily-forecast-section">
          <h2 class="section-title">Daily forecast</h2>
          <div class="daily-forecast-grid" id="dailyForecast">
            ${daily.time.map((date, index) => {
              const dayName = new Date(date).toLocaleDateString('en-US', { weekday: 'short' });
              const dayIcon = weatherIcons[daily.weather_code[index]] || 'icon-sunny.webp';
              const highTemp = Math.round(daily.temperature_2m_max[index]);
              const lowTemp = Math.round(daily.temperature_2m_min[index]);
              const isSelected = index === state.selectedDayIndex;
              
              return `
                <div class="daily-item ${isSelected ? 'selected' : ''}" data-day-index="${index}">
                  <div class="daily-day">${dayName}</div>
                  <img src="./assets/images/${dayIcon}" alt="" class="daily-icon">
                  <div class="daily-temps">
                    <div class="daily-high">${highTemp}°</div>
                    <div class="daily-low">${lowTemp}°</div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </section>
      `;

      // Hourly forecast
      const selectedDate = daily.time[state.selectedDayIndex];
      const selectedDateStart = new Date(selectedDate).setHours(0, 0, 0, 0);
      const selectedDateEnd = selectedDateStart + 24 * 60 * 60 * 1000;
      
      const hourlyForSelectedDay = hourly.time
        .map((time, index) => ({
          time: new Date(time),
          temp: hourly.temperature_2m[index],
          code: hourly.weather_code[index]
        }))
        .filter(item => {
          const timestamp = item.time.getTime();
          return timestamp >= selectedDateStart && timestamp < selectedDateEnd;
        })
        .slice(0, 24);

      const hourlyHTML = `
        <section class="hourly-forecast-section">
          <h2 class="section-title">Hourly forecast</h2>
          <div class="hourly-scroll">
            <div class="hourly-grid">
              ${hourlyForSelectedDay.map(item => {
                const hourIcon = weatherIcons[item.code] || 'icon-sunny.webp';
                const timeStr = item.time.toLocaleTimeString('en-US', { hour: 'numeric', hour12: true });
                const temp = Math.round(item.temp);
                
                return `
                  <div class="hourly-item">
                    <div class="hourly-time">${timeStr}</div>
                    <img src="./assets/images/${hourIcon}" alt="" class="hourly-icon">
                    <div class="hourly-temp">${temp}°</div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        </section>
      `;

      weatherContent.innerHTML = todayHTML + dailyHTML + hourlyHTML;

      // Add click listeners to daily items
      const dailyItems = document.querySelectorAll('.daily-item');
      dailyItems.forEach(item => {
        item.addEventListener('click', () => {
          state.selectedDayIndex = parseInt(item.dataset.dayIndex);
          renderWeather();
        });
      });
    }

    // Convert wind speed based on units
    function convertWindSpeed(ms) {
      if (state.units.windSpeed === 'mph') {
        const mph = ms * 2.237;
        return `${Math.round(mph)} mph`;
      }
      const kmh = ms * 3.6;
      return `${Math.round(kmh)} km/h`;
    }

    // Convert precipitation based on units
    function convertPrecipitation(mm) {
      if (state.units.precipitation === 'in') {
        const inches = mm / 25.4;
        return `${inches.toFixed(2)} in`;
      }
      return `${mm.toFixed(1)} mm`;
    }

    // Get weather description from code
    function getWeatherDescription(code) {
      const descriptions = {
        0: 'Clear sky',
        1: 'Mainly clear',
        2: 'Partly cloudy',
        3: 'Overcast',
        45: 'Fog',
        48: 'Depositing rime fog',
        51: 'Light drizzle',
        53: 'Moderate drizzle',
        55: 'Dense drizzle',
        56: 'Light freezing drizzle',
        57: 'Dense freezing drizzle',
        61: 'Slight rain',
        63: 'Moderate rain',
        65: 'Heavy rain',
        66: 'Light freezing rain',
        67: 'Heavy freezing rain',
        71: 'Slight snow',
        73: 'Moderate snow',
        75: 'Heavy snow',
        77: 'Snow grains',
        80: 'Slight rain showers',
        81: 'Moderate rain showers',
        82: 'Violent rain showers',
        85: 'Slight snow showers',
        86: 'Heavy snow showers',
        95: 'Thunderstorm',
        96: 'Thunderstorm with slight hail',
        99: 'Thunderstorm with heavy hail'
      };
      return descriptions[code] || 'Unknown';
    }

    // Loading state
    function setLoading(loading) {
      if (loading) {
        weatherContent.innerHTML = `
          <div class="loading">
            <img src="./assets/images/icon-loading.svg" alt="Loading" class="loading-spinner">
            <div class="loading-text">Loading weather data...</div>
          </div>
        `;
        searchButton.disabled = true;
      } else {
        searchButton.disabled = false;
      }
    }

    // Error handling
    function showError(message) {
      searchError.textContent = message;
      searchError.classList.add('show');
      
      if (!state.weatherData) {
        weatherContent.innerHTML = `
          <div class="error-state">
            <img src="./assets/images/icon-error.svg" alt="Error" class="error-icon">
            <div class="error-message">Oops! Something went wrong</div>
            <div class="error-details">${message}</div>
            <button class="retry-button" onclick="document.getElementById('searchForm').dispatchEvent(new Event('submit'))">
              <img src="./assets/images/icon-retry.svg" alt="">
              Try Again
            </button>
          </div>
        `;
      }
    }

    function hideError() {
      searchError.classList.remove('show');
    }
  </script>
</body>
</html>
